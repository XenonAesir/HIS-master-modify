<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="Site keywords here">
    <meta name="description" content="">
    <meta name='copyright' content=''>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Title -->
    <title></title>

    <!-- Favicon -->
    <link rel="icon" href="img/favicon.png">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap"
        rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Nice Select CSS -->
    <link rel="stylesheet" href="css/nice-select.css">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!-- icofont CSS -->
    <link rel="stylesheet" href="css/icofont.css">
    <!-- Slicknav -->
    <link rel="stylesheet" href="css/slicknav.min.css">
    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="css/owl-carousel.css">
    <!-- Datepicker CSS -->
    <link rel="stylesheet" href="css/datepicker.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="css/animate.min.css">
    <!-- Magnific Popup CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">

    <!-- Medipro CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- Color CSS -->
    <link rel="stylesheet" href="css/color/color1.css">
    <!--<link rel="stylesheet" href="css/color/color2.css">-->
    <!--<link rel="stylesheet" href="css/color/color3.css">-->
    <!--<link rel="stylesheet" href="css/color/color4.css">-->
    <!--<link rel="stylesheet" href="css/color/color5.css">-->
    <!--<link rel="stylesheet" href="css/color/color6.css">-->
    <!--<link rel="stylesheet" href="css/color/color7.css">-->
    <!--<link rel="stylesheet" href="css/color/color8.css">-->
    <!--<link rel="stylesheet" href="css/color/color9.css">-->
    <!--<link rel="stylesheet" href="css/color/color10.css">-->
    <!--<link rel="stylesheet" href="css/color/color11.css">-->
    <!--<link rel="stylesheet" href="css/color/color12.css">-->

    <link rel="stylesheet" href="#" id="colors">


</head>

<body>

    <header class="header style2">
        <!-- Middle Header -->
        <div class="middle-header" style="padding: 0; padding-top: 10px;">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-12">
                        <!-- Start Logo -->
                        <div class="logo">
                            <img src="img/logo.png" alt="#">
                        </div>
                        <!-- End Logo -->
                        <!-- Mobile Nav -->
                        <div class="mobile-nav"></div>
                        <!-- End Mobile Nav -->
                    </div>
                    <div class="col-lg-9 col-md-9 col-12">
                        <div class="widget-main">
                            <!-- Single Widget -->
                            <div class="single-widget button">
                                <div style="float:left; margin-top: 10px; margin-right: 20px">
                                    工号：<span id="doctor-id"></span>
                                </div>
                                <div class="get-quote" style="float: right;">
                                    <a href="index2.html" class="btn">退出</a>
                                </div>
                            </div>
                            <!--/ End Single Widget -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Middle Header -->

    </header>

    <!-- Start portfolio -->
    <section class="portfolio section" style="padding-top: 20px; height: 100%; width: 100%; ">

        <!-- Start function: records, checkups, prescriptions -->
        <header class="header style2">
            <div class="header-inner">
                <div class="container">
                    <div class="inner">
                        <div class="row">
                            <div class="col-12" style="height: auto;">
                                <!-- Main Menu -->
                                <div class="main-menu" style="float: left;">
                                    <nav class="navigation">
                                        <ul class="nav menu">
                                            <li class="active" id="records"><a href="#" onclick="showRecords()">近期出诊</a>
                                            </li>
                                            <li id="checkups"><a href="#" onclick="showCheckups()">临时短假</a></li>
                                            <li id="history"><a href="#" onclick="showHistory()">申请记录</a></li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--/ End Header Inner -->
        </header>
        <!-- End function: records, checkups, prescriptions -->

        <div class="container">
            <!-- Start records -->
            <div class="func-option doc-records" id="doc-records" style="display: block;">


                <div id="appointmentTableContainer">
                    <!-- 表格将显示在这个容器中 -->
                </div>

            </div>
            <!-- End records -->

            <!-- Start checkups -->
            <div class="func-option doc-checkups" id="doc-checkups" style="display: none;">
                <div style=" padding-left: 12px" class="col-12">
                    <p class="doc-checkups-result">
                    <h6 class="doc-records-item">请假缘由</h6>
                    <textarea class="doc-records-input" id="check_des"></textarea>
                    </p>

                    <p class="doc-checkups-type">
                    <h6 class="doc-records-item doc-checkups-item">日期选择</h6>

                    <input type="text" class="doc-records-date-input" id="dateInput">

                    </p>

                    <div class="doc-records-btngroup">
                        <button class="btn" onclick="confirming()" style="float: right;">提交</button>

                    </div>

                </div>
            </div>
            <!-- End checkups -->

            <!-- Start history -->
            <div class="func-option doc-history" id="doc-history" style="display: none;">
                <div id="vocateTableContainer">
                    <!-- 表格将显示在这个容器中 -->
                </div>
            </div>
            <!-- End history -->

        </div>



    </section>
    <!--/ End portfolio -->


    <!-- jquery Min JS -->
    <script src="js/jquery.min.js"></script>
    <!-- jquery Migrate JS -->
    <script src="js/jquery-migrate-3.0.0.js"></script>
    <!-- jquery Ui JS -->
    <script src="js/jquery-ui.min.js"></script>
    <!-- Easing JS -->
    <script src="js/easing.js"></script>
    <!-- Color JS -->
    <script src="js/colors.js"></script>
    <!-- Popper JS -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap Datepicker JS -->
    <script src="js/bootstrap-datepicker.js"></script>
    <!-- Jquery Nav JS -->
    <script src="js/jquery.nav.js"></script>
    <!-- Slicknav JS -->
    <script src="js/slicknav.min.js"></script>
    <!-- ScrollUp JS -->
    <script src="js/jquery.scrollUp.min.js"></script>
    <!-- Niceselect JS -->
    <script src="js/niceselect.js"></script>
    <!-- Tilt Jquery JS -->
    <script src="js/tilt.jquery.min.js"></script>
    <!-- Owl Carousel JS -->
    <script src="js/owl-carousel.js"></script>
    <!-- counterup JS -->
    <script src="js/jquery.counterup.min.js"></script>
    <!-- Steller JS -->
    <script src="js/steller.js"></script>
    <!-- Wow JS -->
    <script src="js/wow.min.js"></script>
    <!-- Magnific Popup JS -->
    <script src="js/jquery.magnific-popup.min.js"></script>
    <!-- Counter Up CDN JS -->
    <script src="js/waypoints.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Main JS -->
    <script src="js/main.js"></script>

    <style type="text/css">
        /* 定义指针类样式 */
        .pointer {
            cursor: pointer;
            /* 使用 pointer 属性将鼠标指针样式设置为手型，表示可点击 */
        }

        /* 添加CSS样式来美化表格 */
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }



        #meds-drawer {
            margin-top: 10px;
            text-align: right;
            width: 80%;
            /*height: 200px;*/
            padding: 10px 10px;
            border: solid gray 1px;
            border-radius: 10px;
        }

        #searched-meds-name {
            float: left;
        }

        .patient-info {
            height: 20%;
            padding-left: 50px;
        }

        .patient-info-h {
            display: inline-block;
            text-align: center;
            margin-left: 20px;
            margin-right: 50px;
            padding-top: 10px;
        }

        .func-option {
            height: 60%;
        }

        .doc-records-item {
            color: black;
        }

        .doc-checkups-item {
            float: left;
        }

        .doc-records-sympton,
        .doc-records-result,
        .doc-checkups-result,
        .doc-checkups-type {
            padding-left: 30px;
            width: 70%;
            color: black;
            padding-bottom: 30px;
        }

        .doc-records-input {
            margin-left: 30px;
            width: 600px;
            height: 100px;
            resize: none;
        }

        .doc-records-date-input {
            margin-left: 30px;
            width: 100px;
            height: 20px;
            resize: none;
        }



        .doc-checkups-input {
            position: absolute;
            margin-left: 95px;
            width: 300px;
            margin-bottom: 30px;
        }

        .doc-records-item {
            float: left;
        }

        .doc-records-btngroup {
            margin-left: 100px;
            margin-top: 50px;
        }

        .doc-records-format {
            width: 30%;
            background-color: darkslategrey;
            float: left;
        }

        .doc-history {
            margin-top: 20px;
            margin-left: 20px;
            margin-right: 20px;
        }

        .doc-history-list {
            overflow-y: auto;
            width: 50%;
            float: left;
            height: 550px;
        }

        .doc-history-detail {
            width: 50%;
            overflow-y: scroll;
            border: gray solid 1px;
            float: left;
            display: table;
            height: 500px;
        }

        .history-empty {
            width: 100%;
            height: 100%;
            color: gray;
            text-align: center;
            display: table-cell;
            vertical-align: middle;
        }

        .history-detail-text {
            display: none;
            width: 100%;
            height: 100%;
            resize: none;
            overflow-y: scroll;
        }

        .doc-table {
            color: black;
        }

        .doc-table-input {
            border: solid gainsboro 1px;
            width: 80%;
            margin-right: 10px;
        }


        .doc-table-btn {
            font-size: 10px;
            /* height: 20px; */
            padding: 5px 20px;
        }

        .doc-table-editable {
            background-color: gainsboro;
        }

        .doc-prescriptions-btngroup {
            float: right;
            width: 200px;
            margin-right: 20px;
        }

        .doc-prescriptions-btn {
            width: 180px;
            margin-bottom: 10px;
            margin-top: 10px;
        }
    </style>


    <!-- 近期出诊 -->
    <script>
        $(document).ready(function () {
            // 获取医生ID，假设已经存储在sessionStorage中
            const doctorId = sessionStorage.getItem('doctorId');

            // 使用AJAX请求从后端获取数据
            $.ajax({
                url: '/getDoctorAppointments',
                method: 'GET',
                data: { doctorId: doctorId },
                success: function (response) {
                    // 如果成功获取到数据
                    if (response && response.length > 0) {
                        // 创建表格并添加表头
                        let table = '<table class="sortable-table"><thead><tr>' +
                            '<th data-index="0">预约单号</th>' +
                            '<th data-index="1">预约时间</th>' +
                            '<th data-index="2">患者姓名</th>' +
                            '<th data-index="3">患者性别</th>' +
                            '<th data-index="4">患者电话</th>' +
                            '</tr></thead><tbody>';

                        // 遍历预约数据并添加到表格中
                        response.forEach(ReserveInfoDto => {
                            const genderText = ReserveInfoDto.patientGender === 1 ? '男' : '女';
                            table += `<tr><td>${ReserveInfoDto.reserveId}</td><td>${ReserveInfoDto.reserveTime}</td><td>${ReserveInfoDto.patientName}</td><td>${genderText}</td><td>${ReserveInfoDto.patientTel}</td></tr>`;
                        });

                        table += '</tbody></table>';

                        // 将表格添加到页面中的指定容器中
                        $('#appointmentTableContainer').html(table);

                        // 给新表格添加sortable-table类以便识别
                        $('.sortable-table th').click(function () {
                            const index = $(this).data('index');
                            sortTable(index, $(this).closest('.sortable-table')[0]);
                        });

                        // 给表头th绑定鼠标悬停事件
                        $('.sortable-table th').hover(function () {
                            $(this).addClass('pointer');
                        }, function () {
                            $(this).removeClass('pointer');
                        });
                    } else {
                        // 如果没有获取到数据，显示相应信息或执行其他操作
                        $('#appointmentTableContainer').html('<p>没有预约数据</p>');
                    }
                },

                error: function (error) {
                    // 如果请求出现错误，显示错误信息或执行其他操作
                    $('#appointmentTableContainer').html('<p>请求数据时出错</p>');
                    console.error('请求预约数据时出错', error);
                }
            });
        });
        
        let ascendingOrder = true;
        
        function sortTable(columnIndex) {

            // 获取包含 table 的特定 div 元素
            const tableContainer = document.getElementById('appointmentTableContainer');

            // 在该 div 元素内查找 table
            const table = tableContainer.querySelector('table');
            const rows = Array.from(table.querySelectorAll('tbody tr'));

            rows.sort((a, b) => {
                let cellA = a.querySelectorAll('td')[columnIndex].textContent.trim();
                let cellB = b.querySelectorAll('td')[columnIndex].textContent.trim();

                // Convert cell content to appropriate types for sorting
                cellA = isNaN(cellA) ? cellA.toUpperCase() : parseFloat(cellA);
                cellB = isNaN(cellB) ? cellB.toUpperCase() : parseFloat(cellB);

                if (cellA < cellB) return ascendingOrder ? -1 : 1;
                if (cellA > cellB) return ascendingOrder ? 1 : -1;
                return 0;
            });

            // Reverse order for next click
            ascendingOrder = !ascendingOrder;

            // Rearrange rows based on sorting
            rows.forEach(row => table.querySelector('tbody').appendChild(row));
        }

    </script>

    <!-- 临时短假 -->
    <script>
        var nowTemp = new Date();
        var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);

        var checkin = $('#dateInput').datepicker({
            onRender: function (date) {
                var sevenDaysLater = new Date(); // 获取7天后的日期
                sevenDaysLater.setDate(now.getDate() + 6);

                return date.valueOf() < now.valueOf() || date.valueOf() > sevenDaysLater.valueOf() ? 'disabled' : '';
            },
            format: 'yyyy/mm/dd',
            weekStart: 1,
        }).on('changeDate', function (ev) {
            if (ev.date.valueOf() > checkout.date.valueOf()) {
                var newDate = new Date(ev.date)
                newDate.setDate(newDate.getDate() + 1);
                checkout.setValue(newDate);
            }
            checkin.hide();
            $('#dpd2')[0].focus();
        }).data('datepicker');

        function convertDateFormat(inputDate) {
            const dateParts = inputDate.split('/'); // 将输入日期按照 '/' 分隔
            const year = dateParts[0];
            const month = dateParts[1];
            const day = dateParts[2];

            // 构造新日期的格式为 'yyyy-mm-dd 00:00:00'
            const formattedDate = year + '-' + month + '-' + day + ' 00:00:00';

            return formattedDate;
        }

        function confirming() {
            // 获取输入的请假描述和日期
            const description = document.getElementById('check_des').value;
            const date = document.getElementById('dateInput').value;

            // 将日期格式进行转换
            const formattedDate = convertDateFormat(date);


            $.ajax({
                url: "/insertVacate",
                type: "POST",
                data: {
                    "doctorId": sessionStorage.getItem('doctorId'),
                    "description": description,
                    "vacateDate": formattedDate,
                },
                dataType: "json",
                async: true,
                success: function (data) {
                    console.log(data);



                    if (data.status == "ok") {
                        alert("提交成功")
                    }
                    else {
                        alert("异常")
                    }

                },
                error: function (res) {
                    alert("请求错误！", console.res)
                }
            });
        }



    </script>

    <!-- 审批记录 -->
    <script>
$(document).ready(function () {
    // 获取医生ID，假设已经存储在sessionStorage中
    const doctorId = sessionStorage.getItem('doctorId');

    // 使用AJAX请求从后端获取数据
    $.ajax({
        url: '/getVacateByDoctorId',
        method: 'GET',
        data: { doctorId: doctorId },
        success: function (response) {
            // 如果成功获取到数据
            if (response && response.length > 0) {
                // 创建表格并添加表头
                let table = '<table><thead><tr>' +
                    '<th>请假单号</th>' +
                    '<th>医生ID</th>' +
                    '<th>请假描述</th>' +
                    '<th>申请时间</th>' +
                    '<th>请假日期</th>' +
                    '<th>请假状态</th>' +
                    '<th>审批人</th>' +
                    '<th>审批意见</th>' +
                    '</tr></thead><tbody>';

                // 遍历请假数据并添加到表格中
                response.forEach(vacate => {
                    const applyDate = new Date(vacate.applyDate).toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false,
                        timeZone: 'Asia/Shanghai'
                    }).replace(/\//g, '-').replace(',', '');

                    const vacateDate = new Date(vacate.vacateDate).toLocaleDateString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit'
                    }).replace(/\//g, '-');

                    let statusText = '';
                    switch (vacate.status) {
                        case 0:
                            statusText = '未审批';
                            break;
                        case -1:
                            statusText = '未通过';
                            break;
                        case 1:
                            statusText = '已通过';
                            break;
                        default:
                            statusText = '未知状态';
                    }

                    table += `<tr>
                        <td>${vacate.vacateId}</td>
                        <td>${vacate.doctorId}</td>
                        <td>${vacate.description}</td>
                        <td>${applyDate}</td>
                        <td>${vacateDate}</td>
                        <td>${statusText}</td>
                        <td>${vacate.adminId || '-'}</td>
                        <td>${vacate.adminOpinion || '-'}</td>
                    </tr>`;
                });

                table += '</tbody></table>';

                // 将表格添加到页面中的指定容器中
                $('#vocateTableContainer').html(table);
            } else {
                // 如果没有获取到数据，显示相应信息或执行其他操作
                $('#vocateTableContainer').html('<p>没有请假数据</p>');
            }
        },

        error: function (error) {
            // 如果请求出现错误，显示错误信息或执行其他操作
            $('#vocateTableContainer').html('<p>请求数据时出错</p>');
            console.error('请求请假数据时出错', error);
        }
    });
});




    </script>

    <!-- 页面切换 -->
    <script>
        function showRecords() {
            if ($("records").hasClass('active')) return;

            $("#records").addClass('active')
            if ($("#checkups").hasClass) $("#checkups").removeClass('active')
            if ($("#prescriptions").hasClass) $("#prescriptions").removeClass('active')
            if ($("#history").hasClass) $("#history").removeClass('active')

            $("#doc-records").css('display', 'block')
            $("#doc-checkups").css('display', 'none')
            $("#doc-prescriptions").css('display', 'none')
            $("#doc-history").css('display', 'none')
        }

        function showCheckups() {
            if ($("#checkups").hasClass('active')) return;

            $("#checkups").addClass('active')
            if ($("#records").hasClass('active')) $("#records").removeClass('active')
            if ($("#prescriptions").hasClass('active')) $("#prescriptions").removeClass('active')
            if ($("#history").hasClass('active')) $("#history").removeClass('active')

            $("#doc-records").css('display', 'none')
            $("#doc-checkups").css('display', 'block')
            $("#doc-prescriptions").css('display', 'none')
            $("#doc-history").css('display', 'none')
        }

        function showHistory() {
            if ($("#history").hasClass('active')) return;

            $("#history").addClass('active')
            if ($("#checkups").hasClass('active')) $("#checkups").removeClass('active')
            if ($("#records").hasClass('active')) $("#records").removeClass('active')
            if ($("#prescriptions").hasClass('active')) $("#prescriptions").removeClass('active')

            $("#doc-records").css('display', 'none')
            $("#doc-checkups").css('display', 'none')
            $("#doc-prescriptions").css('display', 'none')
            $("#doc-history").css('display', 'block')
        }
    </script>

    <!-- 其它逻辑 -->
    <script>
        // 在页面加载时执行
        window.onload = function () {

            // 找到 ID 为 "doctor-id" 的元素，并将其内容设置为 doctorId
            document.getElementById('doctor-id').innerText = sessionStorage.getItem('doctorId');
        };
        $('.get-quote a').click(function () {
            localStorage.removeItem('doctor_token');
        });

       


    </script>

</body>


</html>