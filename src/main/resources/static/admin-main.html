<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="Site keywords here">
    <meta name="description" content="">
    <meta name='copyright' content=''>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Title -->
    <title></title>

    <!-- Favicon -->
    <link rel="icon" href="img/favicon.png">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap"
        rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Nice Select CSS -->
    <link rel="stylesheet" href="css/nice-select.css">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!-- icofont CSS -->
    <link rel="stylesheet" href="css/icofont.css">
    <!-- Slicknav -->
    <link rel="stylesheet" href="css/slicknav.min.css">
    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="css/owl-carousel.css">
    <!-- Datepicker CSS -->
    <link rel="stylesheet" href="css/datepicker.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="css/animate.min.css">
    <!-- Magnific Popup CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">

    <!-- Medipro CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- Color CSS -->
    <link rel="stylesheet" href="css/color/color1.css">
    <!--<link rel="stylesheet" href="css/color/color2.css">-->
    <!--<link rel="stylesheet" href="css/color/color3.css">-->
    <!--<link rel="stylesheet" href="css/color/color4.css">-->
    <!--<link rel="stylesheet" href="css/color/color5.css">-->
    <!--<link rel="stylesheet" href="css/color/color6.css">-->
    <!--<link rel="stylesheet" href="css/color/color7.css">-->
    <!--<link rel="stylesheet" href="css/color/color8.css">-->
    <!--<link rel="stylesheet" href="css/color/color9.css">-->
    <!--<link rel="stylesheet" href="css/color/color10.css">-->
    <!--<link rel="stylesheet" href="css/color/color11.css">-->
    <!--<link rel="stylesheet" href="css/color/color12.css">-->

    <link rel="stylesheet" href="#" id="colors">


</head>

<body>

    <header class="header style2">
        <!-- Middle Header -->
        <div class="middle-header" style="padding: 0; padding-top: 10px;">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-12">
                        <!-- Start Logo -->
                        <div class="logo">
                            <img src="img/logo.png" alt="#">
                        </div>
                        <!-- End Logo -->
                        <!-- Mobile Nav -->
                        <div class="mobile-nav"></div>
                        <!-- End Mobile Nav -->
                    </div>
                    <div class="col-lg-9 col-md-9 col-12">
                        <div class="widget-main">
                            <!-- Single Widget -->
                            <div class="single-widget button">
                                <div style="float:left; margin-top: 10px; margin-right: 20px">
                                    工号：<span id="admin-id"></span>
                                </div>
                                <div class="get-quote" style="float: right;">
                                    <a href="index2.html" class="btn">退出</a>
                                </div>
                            </div>
                            <!--/ End Single Widget -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Middle Header -->

    </header>

    <!-- Start portfolio -->
    <section class="portfolio section" style="padding-top: 20px; height: 100%; width: 100%; ">

        <!-- Start function: records, checkups, prescriptions -->
        <header class="header style2">
            <div class="header-inner">
                <div class="container">
                    <div class="inner">
                        <div class="row">
                            <div class="col-12" style="height: auto;">
                                <!-- Main Menu -->
                                <div class="main-menu" style="float: left;">
                                    <nav class="navigation">
                                        <ul class="nav menu">
                                            <li class="active" id="history"><a href="#" onclick="showHistory()">短假审批</a>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--/ End Header Inner -->
        </header>
        <!-- End function: records, checkups, prescriptions -->

        <div class="container">

            <!-- Start history -->
            <div class="func-option doc-history" id="doc-history" style="display: block;">
                <div id="vocateTableContainer">
                    <!-- 表格将显示在这个容器中 -->
                </div>
            </div>
            <!-- End history -->

        </div>



    </section>
    <!--/ End portfolio -->


    <!-- jquery Min JS -->
    <script src="js/jquery.min.js"></script>
    <!-- jquery Migrate JS -->
    <script src="js/jquery-migrate-3.0.0.js"></script>
    <!-- jquery Ui JS -->
    <script src="js/jquery-ui.min.js"></script>
    <!-- Easing JS -->
    <script src="js/easing.js"></script>
    <!-- Color JS -->
    <script src="js/colors.js"></script>
    <!-- Popper JS -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap Datepicker JS -->
    <script src="js/bootstrap-datepicker.js"></script>
    <!-- Jquery Nav JS -->
    <script src="js/jquery.nav.js"></script>
    <!-- Slicknav JS -->
    <script src="js/slicknav.min.js"></script>
    <!-- ScrollUp JS -->
    <script src="js/jquery.scrollUp.min.js"></script>
    <!-- Niceselect JS -->
    <script src="js/niceselect.js"></script>
    <!-- Tilt Jquery JS -->
    <script src="js/tilt.jquery.min.js"></script>
    <!-- Owl Carousel JS -->
    <script src="js/owl-carousel.js"></script>
    <!-- counterup JS -->
    <script src="js/jquery.counterup.min.js"></script>
    <!-- Steller JS -->
    <script src="js/steller.js"></script>
    <!-- Wow JS -->
    <script src="js/wow.min.js"></script>
    <!-- Magnific Popup JS -->
    <script src="js/jquery.magnific-popup.min.js"></script>
    <!-- Counter Up CDN JS -->
    <script src="js/waypoints.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Main JS -->
    <script src="js/main.js"></script>

    <style type="text/css">
        /* 定义指针类样式 */
        .pointer {
            cursor: pointer;
            /* 使用 pointer 属性将鼠标指针样式设置为手型，表示可点击 */
        }

        /* 添加CSS样式来美化表格 */
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }



        #meds-drawer {
            margin-top: 10px;
            text-align: right;
            width: 80%;
            /*height: 200px;*/
            padding: 10px 10px;
            border: solid gray 1px;
            border-radius: 10px;
        }

        #searched-meds-name {
            float: left;
        }

        .patient-info {
            height: 20%;
            padding-left: 50px;
        }

        .patient-info-h {
            display: inline-block;
            text-align: center;
            margin-left: 20px;
            margin-right: 50px;
            padding-top: 10px;
        }

        .func-option {
            height: 60%;
        }

        .doc-records-item {
            color: black;
        }

        .doc-checkups-item {
            float: left;
        }

        .doc-records-sympton,
        .doc-records-result,
        .doc-checkups-result,
        .doc-checkups-type {
            padding-left: 30px;
            width: 70%;
            color: black;
            padding-bottom: 30px;
        }

        .doc-records-input {
            margin-left: 30px;
            width: 600px;
            height: 100px;
            resize: none;
        }

        .doc-records-date-input {
            margin-left: 30px;
            width: 100px;
            height: 20px;
            resize: none;
        }



        .doc-checkups-input {
            position: absolute;
            margin-left: 95px;
            width: 300px;
            margin-bottom: 30px;
        }

        .doc-records-item {
            float: left;
        }

        .doc-records-btngroup {
            margin-left: 100px;
            margin-top: 50px;
        }

        .doc-records-format {
            width: 30%;
            background-color: darkslategrey;
            float: left;
        }

        .doc-history {
            margin-top: 20px;
            margin-left: 20px;
            margin-right: 20px;
        }

        .doc-history-list {
            overflow-y: auto;
            width: 50%;
            float: left;
            height: 550px;
        }

        .doc-history-detail {
            width: 50%;
            overflow-y: scroll;
            border: gray solid 1px;
            float: left;
            display: table;
            height: 500px;
        }

        .history-empty {
            width: 100%;
            height: 100%;
            color: gray;
            text-align: center;
            display: table-cell;
            vertical-align: middle;
        }

        .history-detail-text {
            display: none;
            width: 100%;
            height: 100%;
            resize: none;
            overflow-y: scroll;
        }

        .doc-table {
            color: black;
        }

        .doc-table-input {
            border: solid gainsboro 1px;
            width: 80%;
            margin-right: 10px;
        }


        .doc-table-btn {
            font-size: 10px;
            /* height: 20px; */
            padding: 5px 20px;
        }

        .doc-table-editable {
            background-color: gainsboro;
        }

        .doc-prescriptions-btngroup {
            float: right;
            width: 200px;
            margin-right: 20px;
        }

        .doc-prescriptions-btn {
            width: 180px;
            margin-bottom: 10px;
            margin-top: 10px;
        }
    </style>



    <!-- 审批记录 -->
    <script>
        $(document).ready(function () {
            const adminId = sessionStorage.getItem('adminId');

            $.ajax({
                url: '/getVacateByAdminId',
                method: 'GET',
                data: { adminId: adminId },
                success: function (response) {
                    if (response && response.length > 0) {
                        let table = '<table><thead><tr>' +
                            '<th>请假单号</th>' +
                            '<th>医生ID</th>' +
                            '<th>请假描述</th>' +
                            '<th>申请时间</th>' +
                            '<th>请假日期</th>' +
                            '<th>审批</th>' +
                            '</tr></thead><tbody>';

                        response.forEach(vacate => {
                            const applyDate = new Date(vacate.applyDate).toLocaleString('zh-CN', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit',
                                second: '2-digit',
                                hour12: false,
                                timeZone: 'Asia/Shanghai'
                            }).replace(/\//g, '-').replace(',', '');

                            const vacateDate = new Date(vacate.vacateDate).toLocaleDateString('zh-CN', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit'
                            }).replace(/\//g, '-');

                            table += `<tr>
                            <td>${vacate.vacateId}</td>
                            <td>${vacate.adminId}</td>
                            <td>${vacate.description}</td>
                            <td>${applyDate}</td>
                            <td>${vacateDate}</td>
                            <td>
                                <button class="approvalBtn btn" data-vacateid="${vacate.vacateId}">审批</button>
                            </td>
                        </tr>`;
                        });

                        table += '</tbody></table>';
                        $('#vocateTableContainer').html(table);

                        $('.approvalBtn').click(function () {
                            const vacateId = $(this).data('vacateid');
                            if (!vacateId) {
                                alert('无法获取请假单号');
                                return;
                            }
                            let approval = prompt('审批是否通过？（-1不通过，1通过）');

                            // 检查approval是否为合法的数字，为空或者非-1和1的数字都视为非法
                            while (approval === null || approval.trim() === '' || (approval !== '-1' && approval !== '1')) {
                                alert('请输入有效的审批结果：-1表示不通过，1表示通过');
                                approval = prompt('审批是否通过？（-1不通过，1通过）');
                            }

                            let opinion = prompt('请输入审批意见：');

                            // 检查opinion是否为空
                            while (opinion === null || opinion.trim() === '') {
                                alert('审批意见不能为空，请重新输入');
                                opinion = prompt('请输入审批意见：');
                            }


                            $.ajax({
                                url: '/submitApproval',
                                method: 'POST',
                                data: {
                                    vacateId: vacateId,
                                    approval: approval,
                                    opinion: opinion
                                },
                                success: function () {
                                    alert("审批完成")
                                    location.reload();
                                },
                                error: function (error) {
                                    console.error('提交审批时出错', error);
                                }
                            });
                        });
                    } else {
                        $('#vocateTableContainer').html('<p>没有未处理的请假数据</p>');
                    }
                },
                error: function (error) {
                    $('#vocateTableContainer').html('<p>请求数据时出错</p>');
                    console.error('请求请假数据时出错', error);
                }
            });
        });




    </script>

    <!-- 页面切换 -->
    <script>
        function showRecords() {
            if ($("records").hasClass('active')) return;

            $("#records").addClass('active')
            if ($("#checkups").hasClass) $("#checkups").removeClass('active')
            if ($("#prescriptions").hasClass) $("#prescriptions").removeClass('active')
            if ($("#history").hasClass) $("#history").removeClass('active')

            $("#doc-records").css('display', 'block')
            $("#doc-checkups").css('display', 'none')
            $("#doc-prescriptions").css('display', 'none')
            $("#doc-history").css('display', 'none')
        }

        function showCheckups() {
            if ($("#checkups").hasClass('active')) return;

            $("#checkups").addClass('active')
            if ($("#records").hasClass('active')) $("#records").removeClass('active')
            if ($("#prescriptions").hasClass('active')) $("#prescriptions").removeClass('active')
            if ($("#history").hasClass('active')) $("#history").removeClass('active')

            $("#doc-records").css('display', 'none')
            $("#doc-checkups").css('display', 'block')
            $("#doc-prescriptions").css('display', 'none')
            $("#doc-history").css('display', 'none')
        }

        function showHistory() {
            if ($("#history").hasClass('active')) return;

            $("#history").addClass('active')
            if ($("#checkups").hasClass('active')) $("#checkups").removeClass('active')
            if ($("#records").hasClass('active')) $("#records").removeClass('active')
            if ($("#prescriptions").hasClass('active')) $("#prescriptions").removeClass('active')

            $("#doc-records").css('display', 'none')
            $("#doc-checkups").css('display', 'none')
            $("#doc-prescriptions").css('display', 'none')
            $("#doc-history").css('display', 'block')
        }
    </script>

    <!-- 其它逻辑 -->
    <script>
        // 在页面加载时执行
        window.onload = function () {

            // 找到 ID 为 "admin-id" 的元素，并将其内容设置为 adminId
            document.getElementById('admin-id').innerText = sessionStorage.getItem('adminId');
        };
        $('.get-quote a').click(function () {
            localStorage.removeItem('admin_token');
        });

    </script>

</body>


</html>